{% extends 'base.html' %}
{% load static %}

{% block title %}Extracció de dades en curs{% endblock %}

{% block content %}
<main>
    <link rel="stylesheet" href="{% static 'progress.css' %}">
    <div class="card">
        <div class="progress-container">
            <h2>Resum en curs...</h2>
            <div class="progress-circle"></div>
            <p id="status-message">Estem generant les dades basades en el teu document. Pot trigar uns minuts...</p>
        </div>
    </div>

    <script>
        function checkStatus() {
            fetch("{% url 'check_status_extract_info' filename='RESULTADO.json' %}")  // Usamos el nombre fijo
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'completed') {
                        window.location.href = "{% url 'result_extract_info' filename='RESULTADO.json' %}";  // Redirigir a resultados
                    } else {
                        setTimeout(checkStatus, 5000); // Comprobar estado cada 5 segundos
                    }
                })
                .catch(error => {
                    console.error('Error checking status:', error);
                    setTimeout(checkStatus, 5000); // Reintentar tras 5 segundos en caso de error
                });
        }

        checkStatus();  // Iniciar la verificación del estado
    </script>

</main>
{% endblock %}
